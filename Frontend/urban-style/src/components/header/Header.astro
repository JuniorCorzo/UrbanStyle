---
import InputSearch from "@/components/header/InputSearch.astro";
import LoginModal from "./LoginModal.astro";
import UserMenu from "./UserMenu.astro";
import { ShoppingCartIcon } from "@heroicons/react/24/outline";
import { CartStore } from "@/state/cart.state";
const { user } = Astro.locals;
const cartLength = (await CartStore(user.id)).getCartByUserId()?.items.length
---

<header
  class="sticky min-h-14 px-14 flex justify-between items-center backdrop-blur-xs bg-accent/70 top-0 z-20"
  transition:persist
>
<div>
  <h1
    id="home"
    class="text-xl font-bold cursor-pointer"
  >
    Urban Style
  </h1>
</div>
  <div id="links_container" class="relative px-2">
    <ul class="flex w-fit gap-6 items-center justify-center">
      <li>
        <a href="">Hombres</a>
      </li>
      <li>
        <a href="">Mujeres</a>
      </li>
      <li id="search_container" class="flex items-center gap-2 cursor-pointer">
        <span>Buscar</span>
        <InputSearch />
      </li>
    </ul>
  </div>
  <nav class="relative h-full">
    <ul class="flex h-full gap-6 px-2">
      <li>
        <a id="to_cart" class="flex backdrop-blur-xs gap-1 border rounded px-3 py-1 justify-center items-center hover:scale-110 transition-all" title="Carrito de Compras" href="/shopping-cart" type="button">
          <ShoppingCartIcon className="size-5 pointer-events-none"/>
          <span class="text-sm pointer-events-none">{`Carrito ${cartLength === 0 ? '' : `(${cartLength})`}`}</span>
        </a>
      </li>
      <li class="group">
        {
          !user && (
            <button id="login_button" type="button">
              Iniciar Sesi√≥n
            </button>
          <LoginModal />
          )
        }
        {user && <UserMenu user={user} />}
      </li>
    </ul>
  </nav>
</header>

<style>
  nav ul li {
    @apply h-full flex items-center;
  }
</style>

<script>
  import { $ } from "@/lib/dom-selector";
import { navigate } from "astro:transitions/client";

  const initializeListener = () => {
    $<HTMLAnchorElement>("#to_cart")?.addEventListener('click', (event) => {
      event.preventDefault()
      const href = (event.currentTarget as HTMLAnchorElement).href
      navigate(href, {
        history: 'push'
      })
    })

    $('#home')?.addEventListener('click', () => {
      navigate('/home', {
        history: 'push'
      })
    } )

    $("#login_button")?.addEventListener("click", () => {
      $<HTMLDialogElement>("#login_modal")?.showModal();
    });
  }
  document.addEventListener('astro:page-load', initializeListener)
</script>
